#!/bin/sh

#[ "$(echo "$1"| wc -m)" -gt 30 ] && visual="${1:0:20}"..."${1: -7}" || visual="$1"
# Manage to get it working on posix
[ "${#1}" -gt 30 ] && visual="${1%"${1#????????????????????}"}"..."${1#"${1%???????}"}" || visual="$1"

x=$(printf "ï©» vlc\\nğŸ“¥ Download\\nğŸ“‹ Clipboard\\nğŸ§ music\\nyt-dl\\nğŸ“”PDF\\nï´ music shuffle\\nï’ˆ browser\\n ï€¾ sxiv\\nï®§ wget\\nw3m\\nmpv (loop)\\nmpv (float)" | dmenu -i -p "How should I open '$visual'?")
case "$x" in
	"ï©» vlc") notify-send "ï©» VLC Opening..." "ğŸ“¼<i><b>'$2'</b></i>" && vlc "$1" ;;
	"ğŸ“¥ Download") notify-send "ğŸ¼Downloading..." "<u><i>'$2'</i></u>" && youtube-dl --add-metadata -i -x -f bestaudio/best "$1" && notify-send "DoneğŸ‘" "ğŸ“¼<i><b>'$2'</b></i> has finished dowloading";;
	"ğŸ“‹ Clipboard") printf '%s' "$1" | xclip -selection clipboard  && notify-send "ClipboardğŸ“‹" "<b><i>'$1'</i></b> copied" ;;
	"ğŸ§ music") st -t Music -e mpv "$1" --no-video & disown ;;
	"ğŸ“”PDF") curl -sL "$1" > "/tmp/$(echo "$1" | sed "s/.*\///;s/%20/ /g")" && zathura "/tmp/$(echo "$1" | sed "s/.*\///;s/%20/ /g")"  >/dev/null 2>&1 & ;;
	"ï´ music shuffle") st -t Music -e mpv "$1" --no-video --shuffle & disown ;;
	"ï’ˆ browser") $BROWSER "$1" 2>/dev/null & disown ;;
	" ï€¾ sxiv") sxiv "$1" 2&>/dev/null & disown ;;
	"ï®§ wget") wget "$1" 2&/dev/null & disown ;;
	w3m) w3m "$1" 2&>/dev/null & disown ;;
	"mpv (loop)") mpv -quiet --loop "$1" 2&>/dev/null & disown ;;
	"mpv (float)") mpv --geometry=+0-0 --autofix=30% --title="Video" /dev/video0 "$1" 2&>/dev/null & disown ;;
	"yt-dl") qndl "$1" >/dev/null 2>&1 ;;
esac
