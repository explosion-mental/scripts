#!/bin/dash
# Make your clipboard thingys helpful

menu() {
	printf "1.  [URL]   Save as bookmarkğŸ“‘\n"
	printf "2.  [URL]   Open on BrowserğŸ¦Š\n"
	printf "3.  [URL]   Download fileğŸ“¥\n"
	printf "4.  [URL]   Download yt audioğŸ§\n"
	printf "5.  [URL]   Shorten urlâœ‚ï¸\n"
	printf "6.  [URL]   Play videos/audio in mpvğŸ¤ŸğŸ¥\n"
	printf "7.  [Text]  Search on....ğŸ¦†\n"
	printf "8.  [Text]  Convert text to QR image\n"
	printf "9.  [Text]  View on VIM\n"
       printf "10. [Text]  Put something on your clipboard\n"
       printf "10. [Image] Save clipboard imageğŸ”–\n"
       printf "11. [Shell] Run shell command on stğŸ¤–\n"
       printf "12. [GOD]   Save godwords on your clipboard\n"
       printf "13. [I'd just like to interject for a moment.] What youâ€™re referring to as Linux, is in fact, GNU/Linux, or as Iâ€™ve recently taken to calling it, GNU plus Linux. Linux is not an operating system\n"
}
spell_failed() {
	notify-send "Error 404ğŸ¤–"
	exit 1
}

cachedir=/tmp
#[ ! -d "$cachedir" ] && mkdir -p "$cachedir"
# remove tabs and new lines
prompt=$(xclip -o -sel c | tr -d '\t' | tr -d '\n')
# Check if clipboard has something, this doesn't work with images
#[ -z "$prompt" ] && notify-send "Empty clipboardğŸ“" && exit
#{ [ "$prompt" = "" ] && clipmenu ;} & exit
#[ "$prompt" = "" ] && notify-send "Empty clipboardğŸ“" && exit

# if the selected clipboard text is bigger than 30 chars, replaze all other
# after the first 30 chars with '...'
[ "${#prompt}" -gt 30 ] && prompt="${prompt%"${prompt#?????????????????????????}"}"..."${prompt#"${prompt%???????}"}" # || prompt="$prompt"
choice=$(menu | dmenu -p "$prompt" -i -l 20 | cut -d'.' -f1)
#choice=$(menu | cut -f2| dmenu -p "$prompt" -i -l 20 | cut -d. -f1)
cbtext=$(xclip -o -selection clipboard)

case $choice in
    1)
        bookmenu "$cbtext"	;;
    2)
        $BROWSER "$cbtext" &	;; 3)
        qndl "$cbtext" || spell_failed	;;
    4)
        qndl "$cbtext" 'audio'	;;
	#notify-send "â³ Downloading audio..." "<i><u>'$(basename "$1")'</i></u>..."
	#tsp -nf youtube-dl "$1" --add-metadata -icxf bestaudio/best --exec "mv {} $HOME/Downloads"
    5)
        notify-send "Cutting...âœ‚ï¸"
        output=$(curl -s -F"shorten=$cbtext" 0x0.st)
        [ "$output" = "Segmentation fault" ] && spell_failed
        echo "$output" | xclip -sel c &&
        notify-send "Shorten Link is in Clipboard" "<i>$output</i>" ;;
    6)
	setsid -f mpv -quiet --title="Music" "$cbtext" || spell_failed
	notify-send "ğŸ¥ Opening video..."	;;
    7)
	$BROWSER "https://duckduckgo.com/?q=$cbtext" ;;
    8)
	qrencode -o $cachedir/tmpqrcode.png "$cbtext" && \
	sxiv -bp -s f $cachedir/tmpqrcode.png ; rm $cachedir/tmpqrcode.png ;;
    9)
	setsid -f st -e printf '%s' "$cbtext" | nvim ;;#|| spell_failed	;;
    10)
    	printf | dmenu | xclip -i -sel c ;;
    11)
    	d="$(date +'%d-%m_%I_%M_%S')"
        { xclip -sel clipboard -t image/png -o > "$HOME"/clipboard"$d".png && \
	sxiv "$HOME"/clipboard"$d".png ;} || spell_failed ;;
    12)
	setsid -f st -e "$cbtext" #|| spell_failel #;;
	read -r _ ;;
    13)
	godwords | xclip -sel c	;;
    14)
echo "I'd just like to interject for a moment. What youâ€™re referring to as
Linux, is in fact, GNU/Linux, or as Iâ€™ve recently taken to calling it, GNU plus
Linux. Linux is not an operating system unto itself, but rather another free
component of a fully functioning GNU system made useful by the GNU corelibs,
shell utilities and vital system components comprising a full OS as defined by
POSIX.

Many computer users run a modified version of the GNU system every day, without
realizing it. Through a peculiar turn of events, the version of GNU which is
widely used today is often called \â€œLinux\â€, and many of its users are not
aware that it is basically the GNU system, developed by the GNU Project. There
really is a Linux, and these people are using it, but it is just a part of the
system they use.

Linux is the kernel: the program in the system that allocates the machineâ€™s
resources to the other programs that you run. The kernel is an essential part
of an operating system, but useless by itself; it can only function in the
context of a complete operating system. Linux is normally used in combination
with the GNU operating system: the whole system is basically GNU with Linux
added, or GNU/Linux. All the so-called \â€œLinux\â€ distributions are really
distributions of GNU/Linux." | xclip -sel c ;;

esac
